{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>입고 목록 (통합)</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 16px; }
    .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .toolbar { display:flex; gap:10px; align-items:center; margin: 8px 0 16px; }
    .tabs a { padding:6px 10px; border-radius:8px; text-decoration:none; border:1px solid #ddd; }
    .tabs a.active { background:#111; color:#fff; border-color:#111; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border-bottom:1px solid #eee; padding:8px 10px; }
    th { text-align:left; background:#fafafa; }
    .right { text-align:right; }
    .muted { color:#777; }
    .msg { background:#f0f7ff; border:1px solid #cfe2ff; padding:8px 10px; border-radius:8px; margin:8px 0; }
    .filters, .addform { border:1px solid #eee; padding:10px; border-radius:10px; background:#fcfcfc; }
    .pagination a, .pagination span { margin:0 4px; text-decoration:none; }
  </style>
</head>
<body>
  <h2>입고 목록 (통합)</h2>

  {% if messages %}
    <div class="msg">
      {% for m in messages %}{{ m }}<br>{% endfor %}
    </div>
  {% endif %}

  <!-- 카테고리 탭 -->
  {% with curcat=cat|default:"CHEM" %}
  <div class="tabs">
    <a href="{% url 'purchase:uni_receipt_list' %}?cat=CHEM" class="{% if curcat == 'CHEM' %}active{% endif %}">약품</a>
    <a href="{% url 'purchase:uni_receipt_list' %}?cat=NF" class="{% if curcat == 'NF' %}active{% endif %}">비철</a>
    <a href="{% url 'purchase:uni_receipt_list' %}?cat=SUP" class="{% if curcat == 'SUP' %}active{% endif %}">부자재</a>
  </div>
  {% endwith %}

  <!-- 검색 필터 -->
  <form method="get" class="filters">
    <input type="hidden" name="cat" value="{{ cat }}">
    <div class="row">
      <label>거래처:
        <input type="text" name="vendor" value="{{ filter.vendor|default_if_none:'' }}" placeholder="거래처명">
      </label>
      <label>품목:
        <input type="text" name="item" value="{{ filter.item|default_if_none:'' }}" placeholder="품명/스펙">
      </label>
      <label>창고ID:
        <input type="text" name="warehouse_id" value="{{ filter.warehouse_id|default_if_none:'' }}" placeholder="예: 5">
      </label>
      <label>기간:
        <input type="date" name="date_from" value="{{ filter.date_from|default_if_none:'' }}"> ~
        <input type="date" name="date_to"   value="{{ filter.date_to|default_if_none:'' }}">
      </label>
      <button type="submit">검색</button>
      <a href="{% url 'purchase:uni_receipt_list' %}?cat={{ cat }}">초기화</a>
    </div>
  </form>

  <!-- 상단: 입고 등록(즉시입고) 간단 폼 -->
  <form method="post" action="{% url 'purchase:uni_receipt_add' %}" class="addform">
    {% csrf_token %}
    <input type="hidden" name="cat" value="{{ cat }}">
    <div class="row">
      <strong>입고 등록</strong>
      <label>거래처ID
        <input type="number" name="vendor_id" required placeholder="예: 10">
      </label>
      <label>품목(app/model/id)
        <input type="text" name="item_app" required placeholder="예: chemical">
        <input type="text" name="item_model" required placeholder="예: Material">
        <input type="number" name="item_id" required placeholder="예: 123">
      </label>
      <label>수량
        <input type="number" name="qty" min="1" required>
      </label>
      <label>일자
        <input type="date" name="date" value="">
      </label>
      <label>창고ID
        <input type="number" name="warehouse_id" required placeholder="예: 5">
      </label>
      <label>비고
        <input type="text" name="remark" placeholder="선택">
      </label>
      <button type="submit">등록</button>
    </div>
    <div class="muted">※ 품목은 임시로 app/model/id 직접 입력(후에 자동검색으로 개선 예정)</div>
  </form>

  <!-- 목록 -->
  <table>
    <thead>
      <tr>
        <th>LOT</th>
        <th>일자</th>
        <th>거래처</th>
        <th>품목</th>
        <th class="right">수량</th>
        <th>창고</th>
        <th>상태</th>
      </tr>
    </thead>
    <tbody>
      {% for r in page_obj.object_list %}
      <tr>
        <td>{{ r.receipt_lot }}</td>
        <td>{{ r.date }}</td>
        <td>{{ r.vendor }}</td>
        <td>
          <div>{{ r.item_name_snapshot }}</div>
          {% if r.spec_snapshot %}<div class="muted">{{ r.spec_snapshot }}</div>{% endif %}
        </td>
        <td class="right">{{ r.qty }}</td>
        <td>{{ r.warehouse }}</td>
        <td>{% if r.is_used %}사용{% else %}미사용{% endif %}</td>
      </tr>
      {% empty %}
      <tr><td colspan="7" class="muted">데이터가 없습니다.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- 페이지네이션 -->
  <div class="pagination" style="margin-top:10px;">
    {% if page_obj.has_previous %}
      <a href="?page=1&cat={{ cat }}">« 처음</a>
      <a href="?page={{ page_obj.previous_page_number }}&cat={{ cat }}">‹ 이전</a>
    {% endif %}
    <span>페이지 {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}&cat={{ cat }}">다음 ›</a>
      <a href="?page={{ page_obj.paginator.num_pages }}&cat={{ cat }}">마지막 »</a>
    {% endif %}
  </div>

</body>
</html>
