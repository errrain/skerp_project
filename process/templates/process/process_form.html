
{% extends 'base.html' %}
{% load widget_tweaks %}

{% block content %}
<h4>ê³µì •ì •ë³´ ë“±ë¡/ìˆ˜ì •</h4>

<form method="post" enctype="multipart/form-data" novalidate>
    {% csrf_token %}
    <div class="row mb-2">
        <div class="col-md-6">
            <label class="form-label">ê³µì •ëª…</label>
            {{ form.name|add_class:"form-control form-control-sm" }}
        </div>
        <div class="col-md-6">
            <label class="form-label">ê³µì •ì„¤ëª…</label>
            {{ form.description|add_class:"form-control form-control-sm" }}
        </div>
    </div>
    <button type="submit" name="save_process" class="btn btn-success btn-sm">ì €ì¥</button>
    <a href="{% url 'process:process_list' %}" class="btn btn-secondary btn-sm">â† ëª©ë¡</a>
</form>

{% if process %}
<hr class="mt-5 mb-3">
<h5 class="fw-bold">ğŸ“Œ ì‘ì—…í‘œì¤€ì„œ ì´ë ¥</h5>

<table class="table table-sm table-bordered align-middle text-center" style="font-size: 13px;">
    <thead class="table-light">
        <tr>
            <th style="width: 150px;">ë“±ë¡ì¼ì‹œ</th>
            <th>íŒŒì¼ëª…</th>
            <th style="width: 150px;">ë¹„ê³ </th>
            <th style="width: 120px;">ë“±ë¡ì</th>
            <th style="width: 140px;">ì‘ì—…</th>
        </tr>
    </thead>
    <tbody>
        {% for f in files %}
        <tr>
            <td>{{ f.created_at|date:"Y-m-d H:i" }}</td>
            <td class="text-start">
                <a href="{{ f.file.url }}" target="_blank">
                    {{ f.file.name|cut:"process/" }}
                </a>
            </td>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="file_id" value="{{ f.id }}">
                <td>
                    <input type="text" name="note" value="{{ f.note }}" class="form-control form-control-sm text-start">
                </td>
                <td>{{ f.created_by }}</td>
                <td>
                    <button type="submit" formaction="{% url 'process:process_file_update' process.id f.id %}" name="update_note" class="btn btn-outline-primary btn-sm">ìˆ˜ì •</button>
                    <button type="submit" formaction="{% url 'process:process_file_delete' process.id f.id %}" class="btn btn-outline-danger btn-sm"
                        onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ì‚­ì œ</button>
                </td>
            </form>
        </tr>
        {% empty %}
        <tr><td colspan="5" class="text-muted">ë“±ë¡ëœ ì‘ì—…í‘œì¤€ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
        {% endfor %}
    </tbody>
</table>

<form method="post" enctype="multipart/form-data" class="mt-3">
    {% csrf_token %}
    <div class="row g-2 align-items-center">
        <div class="col-md-5">
            {{ file_form.file|add_class:"form-control form-control-sm" }}
        </div>
        <div class="col-md-5">
            {{ file_form.note|add_class:"form-control form-control-sm" }}
        </div>
        <div class="col-md-2">
            <button type="submit" name="upload_file" class="btn btn-outline-success btn-sm">[ + ] íŒŒì¼ë“±ë¡</button>
        </div>
    </div>
</form>
{% endif %}
{% endblock %}
