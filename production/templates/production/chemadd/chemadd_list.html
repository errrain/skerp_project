{% extends 'base.html' %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3" style="font-size: 0.9rem;">
    <h4 class="mb-0">약품 투입일지</h4>
    <a href="{% url 'production:chemadd:chemadd_create' %}" class="btn btn-sm btn-success">
        + 신규등록
    </a>
</div>

<form method="get" class="row g-2 align-items-end mb-3" style="font-size: 0.85rem;">
    <div class="col-auto">
        <label class="form-label mb-1">공정</label>
        <select name="process" class="form-select form-select-sm">
            <option value="">전체</option>
            {% for p in process_list %}
                <option value="{{ p.id }}"
                        {% if selected_process|default:'' == p.id|stringformat:"s" %}selected{% endif %}>
                    {{ p.name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="col-auto">
        <label class="form-label mb-1">시작일</label>
        <input type="date"
               name="date_from"
               value="{{ date_from }}"
               class="form-control form-control-sm">
    </div>

    <div class="col-auto">
        <label class="form-label mb-1">종료일</label>
        <input type="date"
               name="date_to"
               value="{{ date_to }}"
               class="form-control form-control-sm">
    </div>

    <div class="col-auto">
        <label class="form-label mb-1">근무조</label>
        <select name="shift" class="form-select form-select-sm">
            <option value="">전체</option>
            <option value="DAY" {% if selected_shift == "DAY" %}selected{% endif %}>주간</option>
            <option value="NIGHT" {% if selected_shift == "NIGHT" %}selected{% endif %}>야간</option>
        </select>
    </div>

    <div class="col-auto">
        <button type="submit" class="btn btn-sm btn-primary">검색</button>
        <a href="{% url 'production:chemadd:chemadd_list' %}" class="btn btn-sm btn-secondary">초기화</a>
    </div>
</form>

<div class="card" style="font-size: 0.85rem;">
    <div class="card-body p-2">
        <table class="table table-sm table-bordered mb-0 align-middle">
            <thead class="table-light">
                <tr class="text-center">
                    <th style="width: 60px;">No</th>
                    <th style="width: 120px;">일자</th>
                    <th>공정</th>
                    <th style="width: 80px;">근무조</th>
                    <th style="width: 80px;">라인수</th>
                    <th style="width: 120px;">등록자</th>
                    <th style="width: 150px;">등록일시</th>
                    <th style="width: 100px;">관리</th>
                </tr>
            </thead>
            <tbody>
    {% if page_obj.object_list %}
        {% for item in page_obj.object_list %}
            <tr>
                <td class="text-center">
                    {{ forloop.counter }}
                </td>
                <td class="text-center">
                    {{ item.work_date }}
                </td>
                <td>
                    {{ item.process.name }}
                </td>
                <td class="text-center">
                    {{ item.get_shift_display }}
                </td>
                <td class="text-center">
                    {{ item.lines.count }}
                </td>
                <td class="text-center">
                    {{ item.created_by }}
                </td>
                <td class="text-center">
                    {{ item.created_at|date:"Y-m-d H:i" }}
                </td>
                <td class="text-center">
                    <a href="{% url 'production:chemadd:chemadd_edit' item.id %}"
                       class="btn btn-sm btn-outline-primary">
                        상세
                    </a>
                </td>
            </tr>
        {% endfor %}
    {% else %}
        ...
    {% endif %}
</tbody>
        </table>
    </div>
</div>

{% if page_obj.paginator.num_pages > 1 %}
    <nav aria-label="Page navigation" class="mt-2">
        <ul class="pagination pagination-sm justify-content-center mb-0">

            {# 이전 페이지 #}
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page_obj.previous_page_number }}{% if selected_process %}&process={{ selected_process }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}{% if selected_shift %}&shift={{ selected_shift }}{% endif %}">
                        ‹
                    </a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">‹</span></li>
            {% endif %}

            {# 페이지 번호 #}
            {% for num in page_obj.paginator.page_range %}
                {% if num == page_obj.number %}
                    <li class="page-item active">
                        <span class="page-link">{{ num }}</span>
                    </li>
                {% else %}
                    <li class="page-item">
                        <a class="page-link"
                           href="?page={{ num }}{% if selected_process %}&process={{ selected_process }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}{% if selected_shift %}&shift={{ selected_shift }}{% endif %}">
                            {{ num }}
                        </a>
                    </li>
                {% endif %}
            {% endfor %}

            {# 다음 페이지 #}
            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page_obj.next_page_number }}{% if selected_process %}&process={{ selected_process }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}{% if selected_shift %}&shift={{ selected_shift }}{% endif %}">
                        ›
                    </a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">›</span></li>
            {% endif %}
        </ul>
    </nav>
{% endif %}

{% endblock %}
