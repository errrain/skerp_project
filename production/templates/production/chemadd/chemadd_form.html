{% extends 'base.html' %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3" style="font-size: 0.9rem;">
    <h4 class="mb-0">약품 투입 정보</h4>
    <div>
        {% if addition %}
            <form method="post"
                  action="{% url 'production:chemadd:chemadd_delete' addition.id %}"
                  class="d-inline"
                  onsubmit="return confirm('정말 삭제하시겠습니까?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger">삭제</button>
            </form>
        {% endif %}
        <a href="{% url 'production:chemadd:chemadd_list' %}" class="btn btn-sm btn-secondary">목록</a>
    </div>
</div>

<form method="post">
    {% csrf_token %}

    {# ---------------- 헤더 영역 ---------------- #}
    <div class="card mb-3" style="font-size: 0.85rem;">
        <div class="card-header py-2">
            기본정보
        </div>
        <div class="card-body">

            <div class="row g-2 align-items-center mb-2">
                <div class="col-md-4">
                    <label class="form-label mb-1">공정</label>
                    {{ form.process }}
                </div>
                <div class="col-md-3">
                    <label class="form-label mb-1">투입일자</label>
                    {{ form.work_date }}
                </div>
                <div class="col-md-2">
                    <label class="form-label mb-1">근무조</label>
                    {{ form.shift }}
                </div>
                <div class="col-md-3">
                    <label class="form-label mb-1">비고</label>
                    {{ form.remark }}
                </div>
            </div>

        </div>
    </div>

    {# ---------------- 라인 영역 ---------------- #}
    <div class="card mb-3" style="font-size: 0.85rem;">
        <div class="card-header py-2 d-flex justify-content-between align-items-center">
            <span>약품 투입 내역</span>
        </div>
        <div class="card-body p-2">

            {{ formset.management_form }}

            <table class="table table-sm table-bordered align-middle mb-0">
                <thead class="table-light">
                    <tr class="text-center">
                        <th style="width: 40px;">No</th>
                        <th style="width: 220px;">약품</th>
                        <th style="width: 220px;">투입설비</th>
                        <th style="width: 120px;">투입량</th>
                        <th style="width: 80px;">단위</th>
                        <th>비고</th>
                        <th style="width: 60px;">삭제</th>
                    </tr>
                </thead>
                <tbody>
                    {% for form in formset %}
                        <tr>
                            <td class="text-center">
                                {{ forloop.counter }}
                                {% if form.instance.pk %}
                                    {{ form.id }}
                                {% endif %}
                            </td>
                            <td>
                                {{ form.chemical }}
                            </td>
                            <td>
                                {{ form.equipment }}
                            </td>
                            <td>
                                {{ form.quantity }}
                            </td>
                            <td>
                                {{ form.unit }}
                            </td>
                            <td>
                                {{ form.remark }}
                            </td>
                            <td class="text-center">
                                {% if form.instance.pk %}
                                    {{ form.DELETE }}
                                {% else %}
                                    {{ form.DELETE }}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="text-muted mt-1" style="font-size: 0.75rem;">
                * 빈 행은 무시되고, 값이 입력된 행만 저장됩니다.<br>
                * 삭제 체크 후 저장하면 해당 투입 내역이 삭제됩니다.
            </div>

        </div>
    </div>

    <div class="d-flex justify-content-end mb-3" style="gap: 6px;">
        <button type="submit" class="btn btn-sm btn-primary">저장</button>
        <a href="{% url 'production:chemadd:chemadd_list' %}" class="btn btn-sm btn-secondary">목록</a>
    </div>
</form>

{% endblock %}
